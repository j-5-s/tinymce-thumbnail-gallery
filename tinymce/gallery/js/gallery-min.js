var GalleryDialog={preInit:function(){var a;tinyMCEPopup.requireLangPack();a=tinyMCEPopup.getParam("external_image_list_url");document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(a)+'"><\/script>')},init:function(){var e=document.forms[0],b=e.elements,c=tinyMCEPopup.editor,g=c.dom,h=c.selection.getNode(),a=jQuery(h).parents("ul.TINYMCE_gallery").children("li"),d=jQuery(h).parents("ul.TINYMCE_gallery").find("a").css("borderColor");tinyMCEPopup.resizeToInnerSize();this.fillFileList("src_list","tinyMCEImageList");TinyMCE_EditableSelects.init();if(jQuery(h).parents("ul.TINYMCE_gallery").length){jQuery("#is_edit").val(1);jQuery(a).each(function(){var f=jQuery("#gallery_form div.image_wrapper:first").clone();var i=jQuery(this).find("img");jQuery(f).find("input.src").val(jQuery(i).attr("src"));jQuery(f).find("select.src_list").val(jQuery(i).attr("src"));jQuery(f).find("input.src_list").val(jQuery(i).attr("src"));jQuery(f).find("input.alt").val(jQuery(i).attr("alt"));jQuery(f).find("input.x").val(jQuery(i).css("left"));jQuery(f).find("input.y").val(jQuery(i).css("top"));jQuery("#width").val(jQuery(i).parent("a").css("width").replace("px",""));jQuery("#height").val(jQuery(i).parent("a").css("height").replace("px",""));GalleryDialog.previewImage(jQuery(f).find("select.src_list"),jQuery(i).css("left"),jQuery(i).css("top"));jQuery("#gallery_form").append(f)});jQuery("#gallery_form div.image_wrapper:first").remove();jQuery.farbtastic("#picker").setColor(this.borderColorHex(d))}if(h.nodeName=="IMG"){b.src.value=g.getAttrib(h,"src");b.alt.value=g.getAttrib(h,"alt");b.title.value=g.getAttrib(h,"title")}document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image");if(isVisible("srcbrowser")){document.getElementById("src").style.width="260px"}},borderColorHex:function(d){var e=new RegExp("rgb((.*))"),b=e.exec(d),c=b[2].split(","),g=c[0].replace("(",""),f=c[1],a=c[2].replace(")","");return"#"+this.toHex(g)+this.toHex(f)+this.toHex(a)},toHex:function(a){if(typeof a==="undefined"){return"00"}a=parseInt(a);if(a==0||isNaN(a)){return"00"}a=Math.max(0,a);a=Math.min(a,255);a=Math.round(a);return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)},insert:function(c,e){var a=tinyMCEPopup.editor,b=this,d=document.forms[0];if(d.src.value===""){if(a.selection.getNode().nodeName=="IMG"){a.dom.remove(a.selection.getNode());a.execCommand("mceRepaint")}tinyMCEPopup.close();return}if(jQuery("#is_edit").attr("value")==1){a.dom.remove(jQuery(a.selection.getNode()).parents("div.TINYMCE_gallery_wrapper"))}b.insertAndClose()},insertAndClose:function(){var e=tinyMCEPopup.editor,g=document.forms[0],a=g.elements,k,j={},c;tinyMCEPopup.restoreSelection();if(tinymce.isWebKit){e.getWin().focus()}if(!e.settings.inline_styles){j={vspace:a.vspace.value,hspace:a.hspace.value,border:a.border.value,align:getSelectValue(g,"align")}}else{j={vspace:"",hspace:"",border:"",align:""}}tinymce.extend(j,{src:a.src.value,alt:a.alt.value,width:"200px"});c=e.selection.getNode();if(c&&c.nodeName=="IMG"){e.dom.setAttribs(c,j)}else{var h="";jQuery("input[name=src[]]").each(function(){var q=jQuery(this).attr("id");q=q.replace("src","");var o=jQuery(this).parents("div.image_wrapper").find("input.alt").val();var f=parseInt(jQuery(this).parents("div.image_wrapper").find("input.x").val());var p=parseInt(jQuery(this).parents("div.image_wrapper").find("input.y").val());if(f>-10){f=-10}if(p>-10){p=-10}var m=jQuery(this).val();var l=new RegExp(/-300x[0-9]+|-[0-9]+x300/);var n=m.replace(l,"");h+='<li><a class="tinymce-thumbnail-gallery-image" rel="TINYMCE_gallery" title="'+o+'" style="width:'+jQuery("#width").val()+"px;height:"+jQuery("#height").val()+"px;border-color:"+jQuery("#color").val()+'" href="'+n+'"><img alt="'+o+'" style=";left:'+f+"px;top:"+p+"px;border-color:"+jQuery("#color").val()+'" src="'+jQuery(this).val()+'" /></a></li>'});var i=jQuery("<ul> </ul>");if(jQuery("")){var d=jQuery("<div> </div>")}var b=jQuery("<div> </div>");jQuery(i).addClass("TINYMCE_gallery");jQuery(b).addClass("TINYMCE_gallery_wrapper");jQuery(d).append(b);jQuery(i).append(h);jQuery(b).append(i);if(jQuery("#is_edit").val()==0){jQuery(b).after('<p class="JC_credit_link"><!--[TINYMCE_THUMBNAIL_LINK]--></p>')}e.execCommand("mceInsertContent",false,jQuery(d).html(),{skip_undo:1});e.undoManager.add()}tinyMCEPopup.close()},removeImage:function(a){if(jQuery(".image").length>1){jQuery(a).parents(".image_wrapper").remove()}else{tinyMCEPopup.close();return}},getAttrib:function(d,a){var c=tinyMCEPopup.editor,g=c.dom,b,f;if(c.settings.inline_styles){switch(a){case"align":if(b=g.getStyle(d,"float")){return b}if(b=g.getStyle(d,"vertical-align")){return b}break;case"hspace":b=g.getStyle(d,"margin-left");f=g.getStyle(d,"margin-right");if(b&&b==f){return parseInt(b.replace(/[^0-9]/g,""))}break;case"vspace":b=g.getStyle(d,"margin-top");f=g.getStyle(d,"margin-bottom");if(b&&b==f){return parseInt(b.replace(/[^0-9]/g,""))}break;case"border":b=0;tinymce.each(["top","right","bottom","left"],function(e){e=g.getStyle(d,"border-"+e+"-width");if(!e||(e!=b&&b!==0)){b=0;return false}if(e){b=e}});if(b){return parseInt(b.replace(/[^0-9]/g,""))}break}}if(b=g.getAttrib(d,a)){return b}return""},addImage:function(){var c=tinyMCEPopup.editor,f=c.dom,b,e;select_image=tinyMCEPopup.getParam("select_image");var a=jQuery("#gallery_form div.image_wrapper:first").clone();var d=jQuery("#gallery_form div.image_wrapper").length;jQuery(a).find(".field").each(function(){var g=jQuery(this).attr("id")+"_"+d;jQuery(this).attr("id",g);jQuery(this).val("")});jQuery(a).find("img").attr("src",select_image);jQuery(a).appendTo("#gallery_form")},deleteGallery:function(){var a=tinyMCEPopup.editor;var b=jQuery(a.selection.getNode()).parents("div.TINYMCE_gallery_wrapper").parent();a.dom.remove(jQuery(b).find(".JC_credit_link"));a.dom.remove(jQuery(a.selection.getNode()).parents("div.TINYMCE_gallery_wrapper"));tinyMCEPopup.close()},previewImage:function(d,f,e){var h=jQuery(d).parents(".image").children(".image_preview");h.html('<a href="#"><img src="'+jQuery(d).val()+'" /></a><span>Click & drag image to reposition</span>');jQuery(h).children("a").css({width:jQuery("#width").val()+"px",height:jQuery("#height").val()+"px"});jQuery(h).find("img").css({left:f,top:e});jQuery(d).parent().parents(".image").css({height:(parseInt(jQuery("#height").val())+25)+"px"});var c=jQuery(h).find("img").width()/jQuery(h).find("img").height();var g=new Image();g.src=jQuery(h).find("img").attr("src");var b=g.width;var a=g.height;var c=b/a;if(((jQuery("#width").val()*2)/c)<jQuery("#height").val()){jQuery(h).find("img").css({height:jQuery("#height").val()*2+"px"})}else{jQuery(h).find("img").css({width:"200px"})}jQuery(h).find("img").draggable({scroll:false,stop:function(i,j){jQuery(d).parents(".image").children("input.x").attr("value",j.position.left);jQuery(d).parents(".image").children("input.y").attr("value",j.position.top)}})},fillFileList:function(f,c){var e=tinyMCEPopup.dom,a=e.get(f),d,b;c=window[c];a.options.length=0;if(c&&c.length>0){a.options[a.options.length]=new Option("","");tinymce.each(c,function(g){g[1]=jQuery(g[1]).attr("src");a.options[a.options.length]=new Option(g[0],g[1])})}else{e.remove(e.getParent(f,"tr"));alert("You have no images in your WordPress media gallery (Left Sidebar > Media). Add images there first, then you can use them in this plugin");tinyMCEPopup.close()}}};GalleryDialog.preInit();tinyMCEPopup.onInit.add(GalleryDialog.init,GalleryDialog);